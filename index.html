<!DOCTYPE html>
<html>
	<head>
		<title>Resolver API Client Demo</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		
		<!-- Font Awesome -->
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

		<!-- w3css -->
		<link rel="stylesheet" href="css/w3.css">
		<script src="http://ajax.aspnetcdn.com/ajax/jquery/jquery-1.9.0.js"></script>
		<script src="http://ajax.aspnetcdn.com/ajax/knockout/knockout-2.2.1.js"></script>
	</head>
	<body class="w3-white">
	
	<header class="w3-container w3-teal">
		<i class="fa fa-cogs w3-xlarge w3-margin w3-left" aria-hidden="true"></i>
		<h3 class="w3-left">Resolver</h3>
	</header>

	<div class="w3-container w3-black w3-center w3-padding">
		<i id="menu-complaints" class="fa fa-envelope-o w3-xlarge w3-margin-right menuIcon" aria-hidden="true"></i>
		<i id="menu-customers" class="fa fa-address-book-o w3-xlarge w3-margin-right menuIcon" aria-hidden="true"></i>
	</div>

	<div id="main" class="w3-light-gray">


		<!-- ko foreach: complaints -->
		<div class="w3-card-4 w3-white w3-margin">
			<header class="w3-container">
				<h3 class="w3-left w3-text-teal"  data-bind="text: description"></h3>
				<div class="w3-right w3-padding-8">
					<div class="w3-small w3-text-brown">05/03/2017 09:45 PM</div>
					<div class="w3-right">
						<i class="fa fa-star w3-text-yellow" aria-hidden="true"></i>
						<i class="fa fa-star w3-text-yellow" aria-hidden="true"></i>
						<i class="fa fa-star w3-text-yellow" aria-hidden="true"></i>
						<i class="fa fa-star w3-text-gray" aria-hidden="true"></i>
						<i class="fa fa-star w3-text-gray" aria-hidden="true"></i>
					</div>
				</div>
			</header>
			<div class="w3-container w3-padding w3-text-brown">
				<div class="w3-left">
					<i class="fa fa-user w3-text-gray" aria-hidden="true"></i>
					<span data-bind="text: title"></span>
					<i class="fa fa-phone w3-text-gray" aria-hidden="true"></i> Customer phone
					<br />
					<i class="fa fa-address-card w3-text-gray" aria-hidden="true"></i> Customer address
				</div>
				<div class="w3-right">
					<a href="#" data-bind="click: $parent.markDone"><i class="fa fa-check-circle w3-text-green w3-right w3-xxxlarge" aria-hidden="true"></i></a>
				</div>
			</div>
		</div>
		<!-- /ko -->
		
		<a id="btnAddComplaint" class="w3-btn-floating-large w3-teal w3-center" data-bind="click: beginAdd">+</a>

	</div>
	<script type="text/javascript">

		function ComplaintsViewModel() {
		var self = this;
		self.complaintsURI = 'http://localhost:5000/complaints/';
		self.complaints = ko.observableArray();

		self.ajax = function(uri, method, data) {
			var request = {
				url: uri,
				type: method,
				contentType: "application/json",
				accepts: "application/json",
				cache: false,
				dataType: 'jsonp',
				data: JSON.stringify(data),
				beforeSend: function (xhr) {
				},
				error: function(jqXHR) {
					console.log("ajax error " + jqXHR.status);
				}
			};
			return $.ajax(request);
		}

		self.beginAdd = function() {
			alert("Add");
		}

		self.markDone = function(task) {
			task.done(true);
		}

		self.ajax(self.complaintsURI, 'GET').done(function(data) {
			for (var i = 0; i < data.complaints.length; i++) {
				self.complaints.push({
					title: ko.observable(data.complaints[i].cust_name),
					description: ko.observable(data.complaints[i].cust_address),
				});
			}
		});

	}
	ko.applyBindings(new ComplaintsViewModel(), $('#main')[0]);
	</script>
</body>
</html>